!function(name,fn,context){context=this;fn=fn(context,{});for(var key in fn)fn.hasOwnProperty(key)&&!function(key){fn.prototype[key]=function(){fn[key].apply(null,[].concat.call(this.channel,[].slice.call(arguments)));return this}}(key);typeof define==="function"&&typeof module!=="undefined"?module.exports=fn:(context["Hao123"]||(context["Hao123"]={}))[name]=fn}.call(window,"message",function(WIN,channels,undef){var supportPostMessage="postMessage"in WIN,uid=+new Date,NAV=WIN.navigator,storage=!!function(result){try{localStorage.setItem(uid,uid);result=localStorage.getItem(uid)==uid;localStorage.removeItem(uid);return result}catch(e){}}()&&localStorage,each=function(arr,cb){for(var i=0,l=arr.length;i<l;i++)if(cb(arr[i],i,arr)===!1)break},message=function(channel){if(!(this instanceof message))return new message(channel);this.channel=channel},listener=function(e){var data,channel;try{data=JSON.parse(e.data)}catch(e){return}data&&(channel=data.channel)&&(channel=channels[channel])&&each(channel,function(li){li&&li(data.data)})},init={iframe:function(){if(supportPostMessage){if(WIN.addEventListener)WIN.addEventListener("message",listener,false);else WIN.attachEvent("onmessage",listener)}this["iframe"]=null},opener:function(){if(supportPostMessage){if(WIN.addEventListener)WIN.addEventListener("message",listener,false);else WIN.attachEvent("onmessage",listener)}this["iframe"]=null},page:function(){if(storage){if(WIN.addEventListener){WIN.addEventListener("storage",function(e){var data,channel;(data=e.newValue)&&(channel=e.key)&&(channel=channels[channel])&&each(channel,function(li){li&&li(data)})},false)}else{}}this["page"]=null}};message.send=function(channel,data,target){var type=channel.split(".")[0];channel&&{iframe:supportPostMessage?function(){setTimeout(function(){(target||WIN.parent).postMessage(JSON.stringify({data:data,channel:channel}),"*")},0)}:function(){setTimeout(function(){(channel=NAV[channel])&&each(channel,function(callback){callback&&callback(data)})},0)},module:function(){setTimeout(function(){(channel=channels[channel])&&each(channel,function(callback){callback&&callback(data)})},0)},opener:function(){setTimeout(function(){try{(target||WIN.parent).postMessage(JSON.stringify({data:data,channel:channel}),"*")}catch(e){try{channel=WIN.opener.navigator[channel]}catch(e){return}each(channel,function(callback){callback&&callback(data)})}},0)},page:storage?function(){storage[channel]=data+"";setTimeout(function(){storage.removeItem(channel)},0)}:function(){}}[type]();return message};message.on=function(channel,callback){var type=channel.split(".")[0];init[type]&&init[type]();if((type==="iframe"||type==="opener")&&!supportPostMessage){(NAV[type=channel]||(NAV[type]=[])).push(callback)}else channel&&(channels[channel]||(channels[channel]=[])).push(callback);return message};message.off=function(channel,handle){channel&&handle?each(channels[channel],function(callback,i){each(handle instanceof Array?handle:[handle],function(cb){cb===callback&&(channels[channel][i]=null)})}):channels[channel]=[];return message};return message});